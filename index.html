<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CodeGram Bird Full Edition</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #4ec0ca; font-family: 'Arial', sans-serif; }
        canvas { display: block; image-rendering: pixelated; }
        
        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–≤–µ—Ä—Ö –∏–≥—Ä—ã */
        #ui-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.5); visibility: hidden; color: white; text-align: center;
        }
        .menu-card {
            background: #2c3e50; padding: 20px; border-radius: 15px; border: 4px solid #f1c40f;
            width: 80%; max-width: 300px;
        }
        button {
            background: #f1c40f; border: none; padding: 10px 20px; margin: 10px 0;
            border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px;
        }
        .shield-btn { background: #2ecc71; color: white; }
        #leaderboard { margin-top: 15px; font-size: 14px; text-align: left; }
    </style>
</head>
<body>
    <canvas id="game"></canvas>

    <div id="ui-overlay">
        <div class="menu-card">
            <h1 id="status-text">–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê</h1>
            <p>–¢–≤–æ–π —Å—á–µ—Ç: <span id="final-score">0</span></p>
            
            <button id="shield-btn" class="shield-btn">üõ° –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –©–ò–¢</button>
            <button onclick="location.reload()">–ó–ê–ù–û–í–û</button>
            <button onclick="window.Telegram.WebApp.openLink('https://t.me/—Ç–≤–æ–π_–∫–∞–Ω–∞–ª')">üì¢ –ù–ê–® –ö–ê–ù–ê–õ</button>

            <div id="leaderboard">
                <strong>–¢–û–ü –ò–ì–†–û–ö–û–í:</strong>
                <div id="leader-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- –ê–°–°–ï–¢–´ ---
        const birdImg = new Image(); birdImg.src = 'https://i.postimg.cc/8569P49X/bird.png';
        const pipeImg = new Image(); pipeImg.src = 'https://i.postimg.cc/9F7S09fW/pipe-green.png';
        const bgImg = new Image(); bgImg.src = 'https://i.postimg.cc/3w9f6K9z/background.png';

        // --- –°–û–°–¢–û–Ø–ù–ò–ï ---
        let bird = { x: 50, y: 150, w: 44, h: 32, gravity: 0.22, velocity: 0, jump: -4.8, rotation: 0 };
        let pipes = [];
        let score = 0;
        let gameActive = true;
        let hasShield = true; // –©–∏—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ –∏–≥—Ä—É
        let pipeGap = 185; // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ç—Ä—É–±—ã

        function init() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            spawnPipe();
            updateLeaderboard();
        }

        function spawnPipe() {
            let minH = 100;
            let randomY = Math.random() * (canvas.height - pipeGap - minH * 2) + minH;
            pipes.push({ x: canvas.width, y: randomY, passed: false });
        }

        function draw() {
            ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);

            if (gameActive) {
                bird.velocity += bird.gravity;
                bird.y += bird.velocity;
                bird.rotation = Math.min(Math.PI/2, Math.max(-Math.PI/4, bird.velocity * 0.12));

                for (let i = pipes.length - 1; i >= 0; i--) {
                    pipes[i].x -= 2.8;

                    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç—Ä—É–± (—Ç–≤–æ–∏ —Å–ø—Ä–∞–π—Ç—ã)
                    ctx.save();
                    ctx.translate(pipes[i].x + 32, pipes[i].y);
                    ctx.scale(1, -1);
                    ctx.drawImage(pipeImg, -32, 0, 65, pipes[i].y);
                    ctx.restore();
                    ctx.drawImage(pipeImg, pipes[i].x, pipes[i].y + pipeGap, 65, canvas.height);

                    // –ö–æ–ª–ª–∏–∑–∏–∏
                    if (bird.x+8 < pipes[i].x+65 && bird.x+bird.w-8 > pipes[i].x) {
                        if (bird.y+8 < pipes[i].y || bird.y+bird.h-8 > pipes[i].y + pipeGap) gameOver();
                    }

                    if (!pipes[i].passed && pipes[i].x < bird.x) {
                        score++;
                        pipes[i].passed = true;
                        tg.HapticFeedback.impactOccurred('light');
                    }
                    if (pipes[i].x < -70) pipes.splice(i, 1);
                }
                if (pipes[pipes.length-1].x < canvas.width - 250) spawnPipe();
                if (bird.y + bird.h > canvas.height || bird.y < 0) gameOver();
            }

            // –ü—Ç–∏—Ü–∞
            ctx.save();
            ctx.translate(bird.x + bird.w/2, bird.y + bird.h/2);
            ctx.rotate(bird.rotation);
            ctx.drawImage(birdImg, -bird.w/2, -bird.h/2, bird.w, bird.h);
            ctx.restore();

            // –°—á–µ—Ç
            ctx.fillStyle = "white"; ctx.strokeStyle = "black"; ctx.lineWidth = 4;
            ctx.font = "bold 40px Arial"; ctx.textAlign = "center";
            ctx.strokeText(score, canvas.width/2, 60); ctx.fillText(score, canvas.width/2, 60);

            requestAnimationFrame(draw);
        }

        function gameOver() {
            gameActive = false;
            tg.HapticFeedback.notificationOccurred('error');
            document.getElementById('ui-overlay').style.visibility = 'visible';
            document.getElementById('final-score').innerText = score;
            
            // –ï—Å–ª–∏ —â–∏—Ç —É–∂–µ —é–∑–∞–ª–∏ - —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            document.getElementById('shield-btn').style.display = hasShield ? 'block' : 'none';
            saveScore(score);
        }

        // –õ–æ–≥–∏–∫–∞ —â–∏—Ç–∞
        document.getElementById('shield-btn').onclick = () => {
            hasShield = false;
            gameActive = true;
            bird.y = canvas.height / 2;
            bird.velocity = 0;
            pipes = []; // –ß–∏—Å—Ç–∏–º —Ç—Ä—É–±—ã –ø–µ—Ä–µ–¥ –∏–≥—Ä–æ–∫–æ–º
            spawnPipe();
            document.getElementById('ui-overlay').style.visibility = 'hidden';
            tg.HapticFeedback.notificationOccurred('success');
        };

        // –†–∞–±–æ—Ç–∞ —Å "—Ç–∞–±–ª–∏—Ü–µ–π" (–∏–º–∏—Ç–∞—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞)
        function saveScore(s) {
            let highscore = localStorage.getItem('highscore') || 0;
            if (s > highscore) localStorage.setItem('highscore', s);
        }

        function updateLeaderboard() {
            let hs = localStorage.getItem('highscore') || 0;
            document.getElementById('leader-list').innerHTML = `1. –¢—ã (—Ä–µ–∫–æ—Ä–¥): ${hs} –æ—á–∫–æ–≤<br>2. –ò–≥—Ä–æ–∫2: 15<br>3. –ò–≥—Ä–æ–∫3: 10`;
        }

        window.addEventListener('touchstart', (e) => { if(gameActive) bird.velocity = bird.jump; e.preventDefault(); }, {passive:false});

        init();
        draw();
    </script>
</body>
</html>
