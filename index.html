<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ghosty Legend: Pro Graphics</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --sprite: url('https://ibb.co/whJjR54G');
        }

        body { margin: 0; padding: 0; background: #050508; overflow: hidden; font-family: 'Press Start 2P', cursive; touch-action: none; color: white; }
        
        #game-container { position: relative; width: 100vw; height: 100vh; background: #0a0a1a; overflow: hidden; }

        /* –ó–∞–¥–Ω–∏–π –ø–ª–∞–Ω (–ó–∞–º–æ–∫ –∏–∑ –Ω–∏–∂–Ω–µ–π —á–∞—Å—Ç–∏ —Å–ø—Ä–∞–π—Ç–∞) */
        #bg-pixel {
            position: absolute; bottom: 0; width: 200%; height: 100%;
            background: var(--sprite) no-repeat bottom center;
            background-size: 250% auto;
            opacity: 0.5; z-index: 1; pointer-events: none;
            animation: scrollBg 60s linear infinite;
        }

        /* –ü—Ä–∏–∑—Ä–∞–∫ (–ë–µ—Ä–µ–º –∏–∑ –ª–µ–≤–æ–≥–æ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É–≥–ª–∞ —Å–ø—Ä–∞–π—Ç–∞) */
        #bird { 
            position: absolute; width: 60px; height: 60px; z-index: 100; left: 50px;
            background: var(--sprite) no-repeat;
            background-size: 600px 600px; /* –†–∞–∑–º–µ—Ä –≤—Å–µ–≥–æ –ø–æ–ª–æ—Ç–Ω–∞ */
            background-position: -20px -20px; /* –ü–æ–∑–∏—Ü–∏—è –ø—Ä–∏–∑—Ä–∞–∫–∞ */
            display: none; pointer-events: none;
        }

        /* –ö–æ–ª–æ–Ω–Ω—ã (–ë–µ—Ä–µ–º —Ç–µ–∫—Å—Ç—É—Ä—É –∫–∞–º–Ω—è –∏–∑ –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏ —Å–ø—Ä–∞–π—Ç–∞) */
        .pipe { 
            position: absolute; width: 70px; z-index: 50; 
            background: var(--sprite) repeat-y;
            background-size: 600px 600px;
            background-position: -480px 0; /* –¢–µ–∫—Å—Ç—É—Ä–∞ –∫–æ–ª–æ–Ω–Ω—ã */
            border-left: 3px solid #4b0082;
            border-right: 3px solid #4b0082;
            pointer-events: none;
        }

        /* –ù–∞–≤–µ—Ä—à–∏—è –∫–æ–ª–æ–Ω–Ω */
        .pipe::after {
            content: ''; position: absolute; width: 90px; height: 30px;
            background: var(--sprite) no-repeat;
            background-size: 600px 600px;
            background-position: -470px -10px;
            left: -13px; border: 2px solid #000;
        }
        .pipe.top::after { bottom: -15px; }
        .pipe.bottom::after { top: -15px; }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        #ui { position: absolute; inset: 0; pointer-events: none; z-index: 1000; }
        #score { position: absolute; top: 10%; width: 100%; text-align: center; font-size: 30px; text-shadow: 0 0 10px #9b59b6; display: none; }
        #coins { position: absolute; top: 20px; left: 20px; color: #00d4ff; font-size: 12px; }

        .screen { position: absolute; inset: 0; background: rgba(0,0,0,0.85); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; }
        .btn { background: #4b0082; color: white; border: none; padding: 20px; width: 250px; font-family: inherit; margin: 10px; cursor: pointer; border-bottom: 6px solid #2a0044; }
        .btn:active { transform: translateY(3px); border-bottom: 2px solid #2a0044; }

        @keyframes scrollBg { from { background-position: 0 100%; } to { background-position: -1000px 100%; } }
    </style>
</head>
<body>

<div id="game-container">
    <div id="bg-pixel"></div>
    <div id="ui">
        <div id="coins">üíé <span id="orb-val">0</span></div>
        <div id="score">0</div>
    </div>
    <div id="bird"></div>

    <div id="menu" class="screen">
        <h1 style="color:#9b59b6; font-size:18px; margin-bottom:40px;">GHOSTY DARKNESS</h1>
        <button class="btn" onclick="startGame()">START JOURNEY</button>
        <button class="btn" onclick="toggleShop()" style="background:#2980b9;">EVOLUTION</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready();

    let birdY, vel, score, isPlay = false, pipes = [], loop;
    const bird = document.getElementById('bird');
    const scoreVal = document.getElementById('score');
    let orbs = parseInt(localStorage.getItem('gh_orbs')) || 0;

    function startGame() {
        isPlay = true; score = 0; birdY = window.innerHeight/2.5; vel = 0;
        pipes.forEach(p => { p.t.remove(); p.b.remove(); }); pipes = [];
        document.getElementById('menu').style.display = 'none';
        bird.style.display = 'block';
        scoreVal.style.display = 'block';
        scoreVal.innerText = "0";
        document.getElementById('orb-val').innerText = orbs;
        requestAnimationFrame(gameLoop);
    }

    function gameLoop() {
        if (!isPlay) return;
        vel += 0.25; birdY += vel;
        bird.style.top = birdY + 'px';
        bird.style.transform = `rotate(${vel * 3}deg)`;

        if (birdY > window.innerHeight - 60 || birdY < -20) return die();

        if (pipes.length === 0 || pipes[pipes.length-1].x < window.innerWidth - 240) {
            createPipes();
        }

        pipes.forEach((p, i) => {
            p.x -= 3.5;
            p.t.style.left = p.x + 'px';
            p.b.style.left = p.x + 'px';

            const br = bird.getBoundingClientRect();
            const tr = p.t.getBoundingClientRect();
            const brr = p.b.getBoundingClientRect();

            if (br.right-10 > tr.left && br.left+10 < tr.right && (br.top+10 < tr.bottom || br.bottom-10 > brr.top)) die();

            if (!p.pass && p.x < 50) { 
                p.pass = true; score++; orbs++;
                scoreVal.innerText = score;
                document.getElementById('orb-val').innerText = orbs;
                localStorage.setItem('gh_orbs', orbs);
            }
            if (p.x < -100) { p.t.remove(); p.b.remove(); pipes.splice(i, 1); }
        });
        loop = requestAnimationFrame(gameLoop);
    }

    function createPipes() {
        const gap = 190;
        const topH = Math.random() * (window.innerHeight - gap - 200) + 80;
        const botH = window.innerHeight - topH - gap;
        const t = document.createElement('div'); t.className = 'pipe top';
        t.style.height = topH + 'px'; t.style.top = '0';
        const b = document.createElement('div'); b.className = 'pipe bottom';
        b.style.height = botH + 'px'; b.style.bottom = '0';
        document.getElementById('game-container').appendChild(t);
        document.getElementById('game-container').appendChild(b);
        pipes.push({x: window.innerWidth, t, b, pass: false});
    }

    function die() {
        isPlay = false; cancelAnimationFrame(loop);
        document.getElementById('menu').style.display = 'flex';
        bird.style.display = 'none';
        scoreVal.style.display = 'none';
        tg.HapticFeedback.notificationOccurred('error');
    }

    const jump = () => { if(isPlay) vel = -5.5; };
    window.addEventListener('touchstart', jump);
    window.addEventListener('mousedown', jump);
</script>
</body>
</html>
